let hiragana_library = {
  vowels: [
    "./images/hiragana/a.jpg",
    "./images/hiragana/i.jpg",
    "./images/hiragana/u.jpg",
    "./images/hiragana/e.jpg",
    "./images/hiragana/o.jpg",
    "./images/hiragana/a.jpg",
    "./images/hiragana/i.jpg",
    "./images/hiragana/u.jpg",
    "./images/hiragana/e.jpg",
    "./images/hiragana/o.jpg",
  ],
  ks: [
    "./images/hiragana/ka.jpg",
    "./images/hiragana/ki.jpg",
    "./images/hiragana/ku.jpg",
    "./images/hiragana/ke.jpg",
    "./images/hiragana/ko.jpg",
    "./images/hiragana/ka.jpg",
    "./images/hiragana/ki.jpg",
    "./images/hiragana/ku.jpg",
    "./images/hiragana/ke.jpg",
    "./images/hiragana/ko.jpg",
  ],
  ss: [
    "./images/hiragana/hira-sa.png",
    "./images/hiragana/hira-shi.png",
    "./images/hiragana/hira-su.png",
    "./images/hiragana/hira-se.png",
    "./images/hiragana/hira-so.png",
    "./images/hiragana/hira-sa.png",
    "./images/hiragana/hira-shi.png",
    "./images/hiragana/hira-su.png",
    "./images/hiragana/hira-se.png",
    "./images/hiragana/hira-so.png",
  ],
  ts: [
    "./images/hiragana/hira-ta.png",
    "./images/hiragana/hira-chi.png",
    "./images/hiragana/hira-tsu.png",
    "./images/hiragana/hira-te.png",
    "./images/hiragana/hira-to.png",
    "./images/hiragana/hira-ta.png",
    "./images/hiragana/hira-chi.png",
    "./images/hiragana/hira-tsu.png",
    "./images/hiragana/hira-te.png",
    "./images/hiragana/hira-to.png",
  ],
  ns: [
    "./images/hiragana/hira-na.png",
    "./images/hiragana/hira-ni.png",
    "./images/hiragana/hira-nu.png",
    "./images/hiragana/hira-ne.png",
    "./images/hiragana/hira-no.png",
    "./images/hiragana/hira-na.png",
    "./images/hiragana/hira-ni.png",
    "./images/hiragana/hira-nu.png",
    "./images/hiragana/hira-ne.png",
    "./images/hiragana/hira-no.png",
  ],
  hs: [
    "./images/hiragana/hira-ha.png",
    "./images/hiragana/hira-hi.png",
    "./images/hiragana/hira-fu.png",
    "./images/hiragana/hira-he.png",
    "./images/hiragana/hira-ho.png",
    "./images/hiragana/hira-ha.png",
    "./images/hiragana/hira-hi.png",
    "./images/hiragana/hira-fu.png",
    "./images/hiragana/hira-he.png",
    "./images/hiragana/hira-ho.png",
  ],
  ms: [
    "./images/hiragana/hira-ma.png",
    "./images/hiragana/hira-mi.png",
    "./images/hiragana/hira-mu.png",
    "./images/hiragana/hira-me.png",
    "./images/hiragana/hira-mo.png",
    "./images/hiragana/hira-ma.png",
    "./images/hiragana/hira-mi.png",
    "./images/hiragana/hira-mu.png",
    "./images/hiragana/hira-me.png",
    "./images/hiragana/hira-mo.png",
  ],
  ys: [
    "./images/hiragana/hira-ya.png",
    "./images/hiragana/hira-yu.png",
    "./images/hiragana/hira-yo.png",
    "./images/hiragana/hira-ya.png",
    "./images/hiragana/hira-yu.png",
    "./images/hiragana/hira-yo.png",
    "./images/fill.jpg",
    "./images/fill.jpg",
    "./images/fill2.jpg",
    "./images/fill2.jpg",
  ],
  rs: [
    "./images/hiragana/hira-ra.png",
    "./images/hiragana/hira-ri.png",
    "./images/hiragana/hira-ru.png",
    "./images/hiragana/hira-re.png",
    "./images/hiragana/hira-ro.png",
    "./images/hiragana/hira-ra.png",
    "./images/hiragana/hira-ri.png",
    "./images/hiragana/hira-ru.png",
    "./images/hiragana/hira-re.png",
    "./images/hiragana/hira-ro.png",
  ],
  wsn: [
    "./images/hiragana/hira-wa.png",
    "./images/hiragana/hira-wo.png",
    "./images/hiragana/hira-n.png",
    "./images/hiragana/hira-wa.png",
    "./images/hiragana/hira-wo.png",
    "./images/hiragana/hira-n.png",
    "./images/fill.jpg",
    "./images/fill.jpg",
    "./images/fill2.jpg",
    "./images/fill2.jpg",
  ],
};

let kataLibrary = {
  kata_vowels: [
    "./images/katakana/a.png",
    "./images/katakana/i.png",
    "./images/katakana/u.png",
    "./images/katakana/e.png",
    "./images/katakana/o.png",
    "./images/katakana/a.png",
    "./images/katakana/i.png",
    "./images/katakana/u.png",
    "./images/katakana/e.png",
    "./images/katakana/o.png",
  ],
  kata_ks: [
    "./images/katakana/ka.png",
    "./images/katakana/ki.png",
    "./images/katakana/ku.png",
    "./images/katakana/ke.png",
    "./images/katakana/ko.png",
    "./images/katakana/ka.png",
    "./images/katakana/ki.png",
    "./images/katakana/ku.png",
    "./images/katakana/ke.png",
    "./images/katakana/ko.png",
  ],
  kata_ss: [
    "./images/katakana/sa.png",
    "./images/katakana/shi.png",
    "./images/katakana/su.png",
    "./images/katakana/se.png",
    "./images/katakana/so.png",
    "./images/katakana/sa.png",
    "./images/katakana/shi.png",
    "./images/katakana/su.png",
    "./images/katakana/se.png",
    "./images/katakana/so.png",
  ],
  kata_ts: [
    "./images/katakana/ta.png",
    "./images/katakana/chi.png",
    "./images/katakana/tsu.png",
    "./images/katakana/te.png",
    "./images/katakana/to.png",
    "./images/katakana/ta.png",
    "./images/katakana/chi.png",
    "./images/katakana/tsu.png",
    "./images/katakana/te.png",
    "./images/katakana/to.png",
  ],
  kata_ns: [
    "./images/katakana/na.png",
    "./images/katakana/ni.png",
    "./images/katakana/nu.png",
    "./images/katakana/ne.png",
    "./images/katakana/no.png",
    "./images/katakana/na.png",
    "./images/katakana/ni.png",
    "./images/katakana/nu.png",
    "./images/katakana/ne.png",
    "./images/katakana/no.png",
  ],
  kata_hs: [
    "./images/katakana/ha.png",
    "./images/katakana/hi.png",
    "./images/katakana/fu.png",
    "./images/katakana/he.png",
    "./images/katakana/ho.png",
    "./images/katakana/ha.png",
    "./images/katakana/hi.png",
    "./images/katakana/fu.png",
    "./images/katakana/he.png",
    "./images/katakana/ho.png",
  ],
  kata_ms: [
    "./images/katakana/ma.png",
    "./images/katakana/mi.png",
    "./images/katakana/mu.png",
    "./images/katakana/me.png",
    "./images/katakana/mo.png",
    "./images/katakana/ma.png",
    "./images/katakana/mi.png",
    "./images/katakana/mu.png",
    "./images/katakana/me.png",
    "./images/katakana/mo.png",
  ],
  kata_ys: [
    "./images/katakana/ya.png",
    "./images/katakana/yu.png",
    "./images/katakana/yo.png",
    "./images/katakana/ya.png",
    "./images/katakana/yu.png",
    "./images/katakana/yo.png",
    "./images/fill.jpg",
    "./images/fill.jpg",
    "./images/fill2.jpg",
    "./images/fill2.jpg",
  ],
  kata_rs: [
    "./images/katakana/ra.png",
    "./images/katakana/ri.png",
    "./images/katakana/ru.png",
    "./images/katakana/re.png",
    "./images/katakana/ro.png",
    "./images/katakana/ra.png",
    "./images/katakana/ri.png",
    "./images/katakana/ru.png",
    "./images/katakana/re.png",
    "./images/katakana/ro.png",
  ],
  kata_wsn: [
    "./images/katakana/wa.png",
    "./images/katakana/wo.png",
    "./images/katakana/n.png",
    "./images/katakana/wa.png",
    "./images/katakana/wo.png",
    "./images/katakana/n.png",
    "./images/fill.jpg",
    "./images/fill.jpg",
    "./images/fill2.jpg",
    "./images/fill2.jpg",
  ],
};

let cards = document.querySelectorAll(".cards");
let images = [];
let firstCard, secondCard;
let lockBoard = false;
let score = 0;

// Hiragana vs Katakana selection from modal
document.getElementById("hiragana").addEventListener("click", () => {
  $("#myModal").modal("hide");
  document.querySelector(".selection").classList.remove("hidden");

  document.getElementById("hira_picked").classList.remove("hidden");
  document.querySelector(".hira_choice").classList.remove("hidden");

  document.getElementById("kata_picked").classList.add("hidden");
  document.querySelector(".kata_choice").classList.add("hidden");
});

document.getElementById("katakana").addEventListener("click", () => {
  $("#myModal").modal("hide");
  document.querySelector(".selection").classList.remove("hidden");

  document.getElementById("kata_picked").classList.remove("hidden");
  document.querySelector(".kata_choice").classList.remove("hidden");

  document.getElementById("hira_picked").classList.add("hidden");
  document.querySelector(".hira_choice").classList.add("hidden");
});

// Hiragana subgroup selection
document.querySelectorAll(".hira_choice .group").forEach((group) => {
  group.addEventListener("click", (event) => {
    addHira(event);
    startGame();
  });
});

// Katakana subgroup selection
document.querySelectorAll(".kata_choice .group").forEach((group) => {
  group.addEventListener("click", (event) => {
    addKata(event);
    startGame();
  });
});

// Start game: show board
function startGame() {
  document.querySelector(".game-board").classList.remove("hidden");
  document.querySelector(".selection").classList.add("hidden");
}

// Add Hiragana cards
function addHira(event) {
  images = [];
  for (let prop in hiragana_library) {
    if (event.target.id === prop) {
      images.push(...hiragana_library[prop]);
    }
  }
  assignImages();
}

// Add Katakana cards
function addKata(event) {
  images = [];
  for (let prop in kataLibrary) {
    if (event.target.id === prop) {
      images.push(...kataLibrary[prop]);
    }
  }
  assignImages();
}

// Assign images to cards
function assignImages() {
  cards.forEach((card, index) => {
    if (images[index]) {
      card.innerHTML = `
        <div class="back"></div>
        <img src="${images[index]}" alt="char" class="front">
      `;
      card.addEventListener("click", cardFlip);
    }
  });
  shuffle();
}

// Shuffle cards
function shuffle() {
  cards.forEach((card) => {
    let randomPos = Math.floor(Math.random() * 10);
    card.style.order = randomPos;
  });
}

// Flip logic
function cardFlip() {
  if (lockBoard) return;
  if (this === firstCard) return;

  this.classList.add("flip");

  if (!firstCard) {
    firstCard = this;
    return;
  }

  secondCard = this;
  checkMatch();
}

function checkMatch() {
  const firstImg = firstCard.querySelector(".front").src;
  const secondImg = secondCard.querySelector(".front").src;

  if (firstImg === secondImg) {
    disableCards();
    score++;
    if (score === 5) showWin();
  } else {
    unflipCards();
  }
}

function disableCards() {
  firstCard.removeEventListener("click", cardFlip);
  secondCard.removeEventListener("click", cardFlip);
  resetBoard();
}

function unflipCards() {
  lockBoard = true;
  setTimeout(() => {
    firstCard.classList.remove("flip");
    secondCard.classList.remove("flip");
    resetBoard();
  }, 800);
}

function resetBoard() {
  [firstCard, secondCard, lockBoard] = [null, null, false];
}

// Show win screen
function showWin() {
  document.querySelector("#post").classList.remove("hidden");
  document.querySelector(".game-board").classList.add("hidden");
}

// Play again
document.querySelector("#again").addEventListener("click", () => {
  score = 0;
  document.querySelector("#post").classList.add("hidden");
  document.querySelector(".game-board").classList.remove("hidden");
  cards.forEach((card) => card.classList.remove("flip"));
});
