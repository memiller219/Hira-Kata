let hiragana_library = {
  vowels: [
    "./images/hiragana/a.jpg",
    "./images/hiragana/i.jpg",
    "./images/hiragana/u.jpg",
    "./images/hiragana/e.jpg",
    "./images/hiragana/o.jpg",
    "./images/hiragana/a.jpg",
    "./images/hiragana/i.jpg",
    "./images/hiragana/u.jpg",
    "./images/hiragana/e.jpg",
    "./images/hiragana/o.jpg"
  ],
  ks: [
    "./images/hiragana/ka.jpg",
    "./images/hiragana/ki.jpg",
    "./images/hiragana/ku.jpg",
    "./images/hiragana/ke.jpg",
    "./images/hiragana/ko.jpg",
    "./images/hiragana/ka.jpg",
    "./images/hiragana/ki.jpg",
    "./images/hiragana/ku.jpg",
    "./images/hiragana/ke.jpg",
    "./images/hiragana/ko.jpg"
  ],
  ss: [
    "./images/hiragana/hira-sa.png",
    "./images/hiragana/hira-shi.png",
    "./images/hiragana/hira-su.png",
    "./images/hiragana/hira-se.png",
    "./images/hiragana/hira-so.png",
    "./images/hiragana/hira-sa.png",
    "./images/hiragana/hira-shi.png",
    "./images/hiragana/hira-su.png",
    "./images/hiragana/hira-se.png",
    "./images/hiragana/hira-so.png"
  ],
  ts: [
    "./images/hiragana/hira-ta.png",
    "./images/hiragana/hira-chi.png",
    "./images/hiragana/hira-tsu.png",
    "./images/hiragana/hira-te.png",
    "./images/hiragana/hira-to.png",
    "./images/hiragana/hira-ta.png",
    "./images/hiragana/hira-chi.png",
    "./images/hiragana/hira-tsu.png",
    "./images/hiragana/hira-te.png",
    "./images/hiragana/hira-to.png"
  ],
  ns: [
    "./images/hiragana/hira-na.png",
    "./images/hiragana/hira-ni.png",
    "./images/hiragana/hira-nu.png",
    "./images/hiragana/hira-ne.png",
    "./images/hiragana/hira-no.png",
    "./images/hiragana/hira-na.png",
    "./images/hiragana/hira-ni.png",
    "./images/hiragana/hira-nu.png",
    "./images/hiragana/hira-ne.png",
    "./images/hiragana/hira-no.png"
  ],
  hs: [
    "./images/hiragana/hira-ha.png",
    "./images/hiragana/hira-hi.png",
    "./images/hiragana/hira-fu.png",
    "./images/hiragana/hira-he.png",
    "./images/hiragana/hira-ho.png",
    "./images/hiragana/hira-ha.png",
    "./images/hiragana/hira-hi.png",
    "./images/hiragana/hira-fu.png",
    "./images/hiragana/hira-he.png",
    "./images/hiragana/hira-ho.png"
  ],
  ms: [
    "./images/hiragana/hira-ma.png",
    "./images/hiragana/hira-mi.png",
    "./images/hiragana/hira-mu.png",
    "./images/hiragana/hira-me.png",
    "./images/hiragana/hira-mo.png",
    "./images/hiragana/hira-ma.png",
    "./images/hiragana/hira-mi.png",
    "./images/hiragana/hira-mu.png",
    "./images/hiragana/hira-me.png",
    "./images/hiragana/hira-mo.png"
  ],
  ys: [
    "./images/hiragana/hira-ya.png",
    "./images/hiragana/hira-yu.png",
    "./images/hiragana/hira-yo.png",
    "./images/hiragana/hira-ya.png",
    "./images/hiragana/hira-yu.png",
    "./images/hiragana/hira-yo.png",
    "./images/fill.jpg",
    "./images/fill.jpg",
    "./images/fill2.jpg",
    "./images/fill2.jpg"
  ],
  rs: [
    "./images/hiragana/hira-ra.png",
    "./images/hiragana/hira-ri.png",
    "./images/hiragana/hira-ru.png",
    "./images/hiragana/hira-re.png",
    "./images/hiragana/hira-ro.png",
    "./images/hiragana/hira-ra.png",
    "./images/hiragana/hira-ri.png",
    "./images/hiragana/hira-ru.png",
    "./images/hiragana/hira-re.png",
    "./images/hiragana/hira-ro.png"
  ],
  wsn: [
    "./images/hiragana/hira-wa.png",
    "./images/hiragana/hira-wo.png",
    "./images/hiragana/hira-n.png",
    "./images/hiragana/hira-wa.png",
    "./images/hiragana/hira-wo.png",
    "./images/hiragana/hira-n.png",
    "./images/fill.jpg",
    "./images/fill.jpg",
    "./images/fill2.jpg",
    "./images/fill2.jpg"
  ]
};

let kataLibrary = {
  kata_vowels: [
    "./images/katakana/a.png",
    "./images/katakana/i.png",
    "./images/katakana/u.png",
    "./images/katakana/e.png",
    "./images/katakana/o.png",
    "./images/katakana/a.png",
    "./images/katakana/i.png",
    "./images/katakana/u.png",
    "./images/katakana/e.png",
    "./images/katakana/o.png"
  ],
  kata_ks: [
    "./images/katakana/ka.png",
    "./images/katakana/ki.png",
    "./images/katakana/ku.png",
    "./images/katakana/ke.png",
    "./images/katakana/ko.png",
    "./images/katakana/ka.png",
    "./images/katakana/ki.png",
    "./images/katakana/ku.png",
    "./images/katakana/ke.png",
    "./images/katakana/ko.png"
  ],
  kata_ss: [
    "./images/katakana/sa.png",
    "./images/katakana/shi.png",
    "./images/katakana/su.png",
    "./images/katakana/se.png",
    "./images/katakana/so.png",
    "./images/katakana/sa.png",
    "./images/katakana/shi.png",
    "./images/katakana/su.png",
    "./images/katakana/se.png",
    "./images/katakana/so.png"
  ],
  kata_ts: [
    "./images/katakana/ta.png",
    "./images/katakana/chi.png",
    "./images/katakana/tsu.png",
    "./images/katakana/te.png",
    "./images/katakana/to.png",
    "./images/katakana/ta.png",
    "./images/katakana/chi.png",
    "./images/katakana/tsu.png",
    "./images/katakana/te.png",
    "./images/katakana/to.png"
  ],
  kata_ns: [
    "./images/katakana/na.png",
    "./images/katakana/ni.png",
    "./images/katakana/nu.png",
    "./images/katakana/ne.png",
    "./images/katakana/no.png",
    "./images/katakana/na.png",
    "./images/katakana/ni.png",
    "./images/katakana/nu.png",
    "./images/katakana/ne.png",
    "./images/katakana/no.png"
  ],
  kata_hs: [
    "./images/katakana/ha.png",
    "./images/katakana/hi.png",
    "./images/katakana/fu.png",
    "./images/katakana/he.png",
    "./images/katakana/ho.png",
    "./images/katakana/ha.png",
    "./images/katakana/hi.png",
    "./images/katakana/fu.png",
    "./images/katakana/he.png",
    "./images/katakana/ho.png"
  ],
  kata_ms: [
    "./images/katakana/ma.png",
    "./images/katakana/mi.png",
    "./images/katakana/mu.png",
    "./images/katakana/me.png",
    "./images/katakana/mo.png",
    "./images/katakana/ma.png",
    "./images/katakana/mi.png",
    "./images/katakana/mu.png",
    "./images/katakana/me.png",
    "./images/katakana/mo.png"
  ],
  kata_ys: [
    "./images/katakana/ya.png",
    "./images/katakana/yu.png",
    "./images/katakana/yo.png",
    "./images/katakana/ya.png",
    "./images/katakana/yu.png",
    "./images/katakana/yo.png",
    "./images/fill.jpg",
    "./images/fill.jpg",
    "./images/fill2.jpg",
    "./images/fill2.jpg"
  ],
  kata_rs: [
    "./images/katakana/ra.png",
    "./images/katakana/ri.png",
    "./images/katakana/ru.png",
    "./images/katakana/re.png",
    "./images/katakana/ro.png",
    "./images/katakana/ra.png",
    "./images/katakana/ri.png",
    "./images/katakana/ru.png",
    "./images/katakana/re.png",
    "./images/katakana/ro.png"
  ],
  kata_wsn: [
    "./images/katakana/wa.png",
    "./images/katakana/wo.png",
    "./images/katakana/n.png",
    "./images/katakana/wa.png",
    "./images/katakana/wo.png",
    "./images/katakana/n.png",
    "./images/fill.jpg",
    "./images/fill.jpg",
    "./images/fill2.jpg",
    "./images/fill2.jpg"
  ]
};

// initial game settings:
let images = [],
  firstCard = "",
  secondCard = "",
  hasFlipped = false,
  score = 0;

let group = document.querySelectorAll(".group"),
  hira = document.getElementById("hiragana"),
  kata = document.getElementById("katakana"),
  h_picked = document.getElementById("hira_picked"),
  k_picked = document.getElementById("kata_picked"),
  hiraChoice = document.querySelector(".hira_choice"),
  kataChoice = document.querySelector(".kata_choice"),
  select = document.querySelector(".selection"),
  board = document.querySelector(".game-board"),
  cards = document.querySelectorAll(".cards"),
  playBtn = document.querySelector(".play"),
  again = document.getElementById("again"),
  post = document.querySelector("#post");

// Selecting a category
function category() {
  playBtn.classList.add("hidden");
  select.classList.remove("hidden");
  $("#myModal").modal("hide");
  document.addEventListener("click", function(event) {
    if (event.target.matches("#hiragana")) {
      k_picked.classList.add("hidden");
    } else if (event.target.matches("#katakana")) {
      h_picked.classList.add("hidden");
      hiraChoice.classList.add("hidden");
      kataChoice.classList.remove("hidden");
    }
  });
  document.addEventListener(
    "click",
    function(event) {
      if (!event.target.matches(".group")) return;
      event.preventDefault();
      board.classList.remove("hidden");
      select.classList.add("hidden");
    },
    false
  );
}

hira.addEventListener("click", category);
kata.addEventListener("click", category);

// card flip
function cardFlip() {
  this.classList.add("flip");

  if (!hasFlipped) {
    hasFlipped = true;
    firstCard = this;
  } else if (this !== firstCard) {
    hasFlipped = false;
    secondCard = this;

    // not a match
    if (firstCard.firstChild.src !== secondCard.firstChild.src) {
      setTimeout(function() {
        firstCard.classList.remove("flip");
        secondCard.classList.remove("flip");
      }, 800);
      // it's a match!
    } else {
      setTimeout(function() {
        firstCard.removeEventListener("click", cardFlip);
        secondCard.removeEventListener("click", cardFlip);
      }, 800);
      score++;
    }
  }
  if (score === 5) {
    setTimeout(function() {
      playAgain();
    }, 600);
  }
}

cards.forEach(card => card.addEventListener("click", cardFlip));

// This determines which group to add to the cards
document.addEventListener("click", function(event) {
  if (event.target.matches("#hiragana")) {
    group.forEach(elem =>
      elem.addEventListener("click", function() {
        addHira();
      })
    );
  } else if (event.target.matches("#katakana")) {
    group.forEach(elem =>
      elem.addEventListener("click", function() {
        addKata();
      })
    );
  }
});

// function adding hiragana images to cards
function addHira() {
  for (let prop in hiragana_library) {
    if (event.target.id === prop) {
      for (let i = 0; i < 10; i++) {
        images.push(hiragana_library[prop][i]);
      }
      for (let j = 0; j < 10; j++) {
        cards[j].innerHTML =
          "<img src='" + images[j] + "'alt='image' class='front back'>";
      }
    }
  }
}

// function adding katakana images to cards
function addKata() {
  for (let prop in kataLibrary) {
    if (event.target.id === prop) {
      for (let i = 0; i < 10; i++) {
        images.push(kataLibrary[prop][i]);
      }
      for (let j = 0; j < 10; j++) {
        cards[j].innerHTML =
          "<img src='" + images[j] + "'alt='image' class='front back'>";
      }
    }
  }
}

// Shuffling cards
(function shuffle() {
  cards.forEach(card => {
    let randomPos = Math.floor(Math.random() * 10);
    card.style.order = randomPos;
  });
})();

function playAgain() {
  // reset the game
  post.classList.remove("hidden");
  again.addEventListener("click", function() {
    playBtn.classList.remove("hidden");
    board.classList.add("hidden");
    select.classList.add("hidden");
    post.classList.add("hidden");
    document.location.reload();
  });
}
